{% extends 'base.html.twig' %}

{% block title %}Hello OrderController!{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

<script>
function updateOrder(id, val) {
    $.post("/updateOrder", {orderid: id, orderStatus: val});
};
</script>
<body>
    <div data-role="header" class="ui-bar">
        <h1>Driver Orders</h1>
    </div>
    <div role="page" class="ui-content" id="mainpage">
        <a href="#weather" class="ui-btn ui-btn-inline" id="weathere">Check Weather</a>
        {{dump(orders)}}
        <div role="content" class="ui-content">
                {% for order in orders %}
                <div class="ui-field-contain">
                    <h4>Order No. {{ order.id}}</h4>
                    <table data-role="table" id="order{{order.id}}" class="ui-responsive table-stroke">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Delivery Address</th>
                                <th>Order Amount</th>
                                <th data-priority="1">Order Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td id="orderID">{{ order.id }}</td>
                                <td>{{ order.orderaddress }}</td>
                                <td>{{ order.amount }}</td>
                                <td>
                                    <select name="status" id="statusselect" orderNo="{{order.id}}" class="orderstatus">
                                        <option {% if order.orderstatus == "submitted" %} selected="selected" {% endif %} value="submitted" id="submitted">Order Submitted</option>
                                        <option {% if order.orderstatus == "outfordelivery" %} selected="selected" {% endif %} value="outfordelivery" id="outfordelivery">Out for Delivery</option>
                                        <option {% if order.orderstatus == "delivered" %} selected="selected" {% endif %} value="delivered" id="delivered">Delivered</option>
                                    </select>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <hr>
                </div>
                {% endfor %}
        </div>
    </div>

    <script>
    $('[id^="statusselect"]').change(function () {
        var orderid = $(this).attr('orderNo');
        var orderStatus = $(this).children("option:selected").val();
        
        alert("You have selected value from order no. " + orderid + " with status of " + orderStatus);      
        updateOrder(orderid, orderStatus);
    });

    </script>
    </body>

{% endblock %}